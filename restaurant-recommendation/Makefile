# Makefile for Restaurant Recommendation App Docker Operations

.PHONY: help build run stop clean test lint format dev prod logs shell

# Default target
help:
	@echo "ğŸ³ Restaurant App Docker Commands"
	@echo ""
	@echo "Development:"
	@echo "  make dev          - Start development environment"
	@echo "  make prod         - Start production environment"
	@echo "  make logs         - View application logs"
	@echo "  make shell        - Open shell in running container"
	@echo ""
	@echo "Building:"
	@echo "  make build        - Build Docker image"
	@echo "  make clean        - Clean up Docker resources"
	@echo ""
	@echo "Testing:"
	@echo "  make test         - Run tests"
	@echo "  make lint         - Run linting"
	@echo "  make format       - Format code"
	@echo ""
	@echo "Utilities:"
	@echo "  make stop         - Stop all containers"
	@echo "  make restart      - Restart containers"

# Development commands
dev:
	@echo "ğŸš€ Starting development environment..."
	docker-compose up --build

prod:
	@echo "ğŸš€ Starting production environment..."
	docker-compose -f docker-compose.yml up --build -d

# Build commands
build:
	@echo "ğŸ”¨ Building Docker image..."
	docker build -t restaurant-app .

# Container management
run:
	@echo "ğŸƒ Running container..."
	docker run -p 5000:5000 restaurant-app

stop:
	@echo "ğŸ›‘ Stopping containers..."
	docker-compose down

restart: stop dev

# Development utilities
logs:
	@echo "ğŸ“‹ Viewing logs..."
	docker-compose logs -f

shell:
	@echo "ğŸš Opening shell in container..."
	docker-compose exec restaurant-app bash

# Testing and quality
test:
	@echo "ğŸ§ª Running tests..."
	docker-compose exec restaurant-app pytest

lint:
	@echo "ğŸ” Running linting..."
	docker-compose exec restaurant-app flake8 .

format:
	@echo "âœ¨ Formatting code..."
	docker-compose exec restaurant-app black .

# Cleanup
clean:
	@echo "ğŸ§¹ Cleaning up Docker resources..."
	docker-compose down -v
	docker system prune -f
	docker image prune -f

# Health check
health:
	@echo "ğŸ¥ Checking application health..."
	curl -f http://localhost:5000/ || echo "âŒ Application not responding"

# Install dependencies (for local development)
install:
	@echo "ğŸ“¦ Installing dependencies..."
	pip install -r requirements.txt
	pip install pytest flake8 black

# Run all quality checks
check: lint format test
	@echo "âœ… All quality checks passed!"
