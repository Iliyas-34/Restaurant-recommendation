{% extends "base.html" %}
{% block title %}Home | Restaurant Finder{% endblock %}

{% block content %}

<!-- Hero Section -->
<div class="hero text-center py-24 animate-fadeIn">
  <div class="welcome-text">
    <h1 class="homepage-title text-4xl md:text-5xl font-semibold">Welcome to Restaurant Finder 🍴</h1>
    <p class="homepage-tagline mt-4 text-lg md:text-xl">Discover the best places to eat around you!</p>
  </div>
  <a href="{{ url_for('restaurants_page') }}" class="btn inline-block mt-6">Explore Restaurants</a>
  
  <!-- Premium Search Bar with Side Filters -->
  <div class="search-section mt-8">
    <div class="search-and-filters-container">
      <!-- Search Bar -->
      <div class="search-wrapper">
        <input type="text" id="search-input" placeholder="Search food or place..." class="search-input-visible" oninput="handleSearchInput()" onblur="setTimeout(() => hideSearchSuggestions(), 200)">
        <i class="fa fa-search search-icon" onclick="submitSearch()" aria-hidden="true"></i>
      </div>
      
      <!-- Modern Smart Filters Section -->
      <div class="smart-filters-container">
        <div class="filters-header">
          <div class="filters-title">
            <span class="filters-icon">🎯</span>
            <h3>Smart Filters</h3>
          </div>
          <p class="filters-subtitle">Get personalized recommendations based on your preferences</p>
        </div>
        
        <div class="filters-row">
          <div class="filter-item">
            <div class="filter-label">
              <span class="filter-emoji">😊</span>
              <span class="filter-text">Mood</span>
            </div>
            <div class="filter-dropdown">
              <select id="mood-filter" class="modern-select">
                <option value="">Choose your mood</option>
                <option value="happy">😊 Happy & Energetic</option>
                <option value="sad">😢 Need Comfort Food</option>
                <option value="angry">😠 Spicy & Bold</option>
                <option value="relaxed">😌 Calm & Cozy</option>
                <option value="excited">🤩 Adventurous</option>
                <option value="bored">😐 Something New</option>
              </select>
            </div>
          </div>
          
          <div class="filter-item">
            <div class="filter-label">
              <span class="filter-emoji">🕐</span>
              <span class="filter-text">Time of Day</span>
            </div>
            <div class="filter-dropdown">
              <select id="time-filter" class="modern-select">
                <option value="">Select time</option>
                <option value="morning">🌅 Morning (6AM-12PM)</option>
                <option value="afternoon">☀️ Afternoon (12PM-6PM)</option>
                <option value="evening">🌆 Evening (6PM-10PM)</option>
                <option value="night">🌙 Night (10PM-6AM)</option>
              </select>
            </div>
          </div>
          
          <div class="filter-item">
            <div class="filter-label">
              <span class="filter-emoji">🎉</span>
              <span class="filter-text">Occasion</span>
            </div>
            <div class="filter-dropdown">
              <select id="occasion-filter" class="modern-select">
                <option value="">Pick an occasion</option>
                <option value="dinner">🍽️ Romantic Dinner</option>
                <option value="lunch">🥗 Business Lunch</option>
                <option value="date">💕 Date Night</option>
                <option value="birthday">🎂 Birthday Celebration</option>
                <option value="party">🎉 Party & Fun</option>
                <option value="meeting">💼 Meeting</option>
                <option value="anniversary">💍 Anniversary</option>
                <option value="family">👨‍👩‍👧‍👦 Family Time</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="filter-actions">
          <button class="filter-primary-btn" onclick="applySmartFilters()">
            <span class="btn-icon">✨</span>
            <span class="btn-text">Find Perfect Match</span>
          </button>
          <button class="filter-secondary-btn" onclick="clearAllFilters()">
            <span class="btn-icon">🔄</span>
            <span class="btn-text">Clear Filters</span>
          </button>
        </div>
      </div>
    </div>
    <div id="suggestion-box" class="suggestion-box" aria-live="polite"></div>
  </div>
  
  <!-- Smart Filter Results -->
  <div id="smart-filter-results" class="smart-filter-results" style="display: none;"></div>
</div>

<!-- Featured Restaurants Carousel -->
<section class="featured-section">
  <div class="container">
    <h2 class="section-title">🏆 Featured Restaurants</h2>
    <p class="section-subtitle">Discover the most loved dining experiences</p>
    <div class="restaurant-carousel" id="featuredRestaurants">
      <!-- Featured restaurants will be loaded dynamically -->
      <div class="loading-placeholder">
        <p>Loading featured restaurants...</p>
      </div>
    </div>
  </div>
</section>

<!-- Near You Section -->
<section class="near-you-section">
  <div class="container">
    <h2 class="section-title">📍 Restaurants Near You</h2>
    <p class="section-subtitle">Discover amazing places in your area</p>
    <div class="location-input-container">
      <input type="text" id="location-input" placeholder="Enter your location or use current location">
      <button onclick="getCurrentLocation()" class="location-btn">📍</button>
    </div>
    <div class="nearby-restaurants" id="nearbyRestaurants">
      <!-- Nearby restaurants will be loaded dynamically -->
      <div class="loading-placeholder">
        <p>Enter your location to find nearby restaurants</p>
      </div>
    </div>
    <button class="explore-nearby-btn" onclick="searchNearbyRestaurants()">Search Nearby</button>
  </div>
</section>

<!-- Trending Searches -->
<section class="trending-section">
  <div class="container">
    <h2 class="section-title">💡 Trending Searches</h2>
    <p class="section-subtitle">What everyone's looking for right now</p>
    <div class="trending-tags">
      <div class="trending-tag trending-1">
        <span class="trending-text">Biryani</span>
        <span class="trending-count">2.3k searches</span>
      </div>
      <div class="trending-tag trending-2">
        <span class="trending-text">Bubble Tea</span>
        <span class="trending-count">1.8k searches</span>
      </div>
      <div class="trending-tag trending-3">
        <span class="trending-text">Sushi</span>
        <span class="trending-count">1.5k searches</span>
      </div>
      <div class="trending-tag trending-4">
        <span class="trending-text">Pizza</span>
        <span class="trending-count">3.1k searches</span>
      </div>
      <div class="trending-tag trending-5">
        <span class="trending-text">Desserts</span>
        <span class="trending-count">1.2k searches</span>
      </div>
      <div class="trending-tag trending-6">
        <span class="trending-text">Vegan</span>
        <span class="trending-count">980 searches</span>
      </div>
    </div>
  </div>
</section>


<!-- Mood-Based Filters -->
<section class="mood-section">
  <div class="container">
    <h2 class="section-title">🎯 Find Your Perfect Vibe</h2>
    <p class="section-subtitle">Tell us your mood and we'll find the perfect restaurant</p>
    <div class="mood-filters">
      <div class="mood-card" onclick="filterByMood('romantic')">
        <div class="mood-icon">💕</div>
        <h4>Romantic</h4>
        <p>Perfect for date nights</p>
      </div>
      <div class="mood-card" onclick="filterByMood('family')">
        <div class="mood-icon">👨‍👩‍👧‍👦</div>
        <h4>Family-Friendly</h4>
        <p>Great for all ages</p>
      </div>
      <div class="mood-card" onclick="filterByMood('business')">
        <div class="mood-icon">💼</div>
        <h4>Business</h4>
        <p>Professional meetings</p>
      </div>
      <div class="mood-card" onclick="filterByMood('casual')">
        <div class="mood-icon">😊</div>
        <h4>Casual</h4>
        <p>Relaxed dining</p>
      </div>
      <div class="mood-card" onclick="filterByMood('late-night')">
        <div class="mood-icon">🌙</div>
        <h4>Late Night</h4>
        <p>Open after hours</p>
      </div>
      <div class="mood-card" onclick="filterByMood('celebration')">
        <div class="mood-icon">🎉</div>
        <h4>Celebration</h4>
        <p>Special occasions</p>
      </div>
    </div>
  </div>
</section>

<!-- Instagram-Style Food Gallery -->
<section class="food-gallery-section">
  <div class="container">
    <h2 class="section-title">📸 Food Gallery</h2>
    <p class="section-subtitle">Real food photos from our community</p>
    <div class="food-gallery">
      <div class="gallery-item">
        <img src="/static/images/food1.jpg" alt="Delicious Pasta">
        <div class="gallery-overlay">
          <button class="wishlist-btn" onclick="addToWishlist('pasta')">❤️</button>
          <span class="restaurant-name">Bella Vista</span>
        </div>
      </div>
      <div class="gallery-item">
        <img src="/static/images/food2.jpg" alt="Fresh Sushi">
        <div class="gallery-overlay">
          <button class="wishlist-btn" onclick="addToWishlist('sushi')">❤️</button>
          <span class="restaurant-name">Sakura Sushi</span>
        </div>
      </div>
      <div class="gallery-item">
        <img src="/static/images/food3.jpg" alt="Grilled Steak">
        <div class="gallery-overlay">
          <button class="wishlist-btn" onclick="addToWishlist('steak')">❤️</button>
          <span class="restaurant-name">Smokehouse Grill</span>
        </div>
      </div>
      <div class="gallery-item">
        <img src="/static/images/cake.jpg" alt="Chocolate Cake">
        <div class="gallery-overlay">
          <button class="wishlist-btn" onclick="addToWishlist('cake')">❤️</button>
          <span class="restaurant-name">Sweet Dreams</span>
        </div>
      </div>
      <div class="gallery-item">
        <img src="/static/images/icecream.jpg" alt="Ice Cream">
        <div class="gallery-overlay">
          <button class="wishlist-btn" onclick="addToWishlist('icecream')">❤️</button>
          <span class="restaurant-name">Frozen Delights</span>
        </div>
      </div>
      <div class="gallery-item">
        <img src="/static/images/coffee.jpg" alt="Coffee">
        <div class="gallery-overlay">
          <button class="wishlist-btn" onclick="addToWishlist('coffee')">❤️</button>
          <span class="restaurant-name">Café Mocha</span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- User Reviews & Testimonials -->
<section class="reviews-section">
  <div class="container">
    <h2 class="section-title">🧾 What Our Users Say</h2>
    <p class="section-subtitle">Real experiences from real people</p>
    <div class="testimonials">
      <div class="testimonial-card">
        <div class="testimonial-header">
          <img src="/static/images/restaurant-default.jpg" alt="Sarah" class="user-avatar">
          <div class="user-info">
            <h4>Sarah M.</h4>
            <div class="stars">⭐⭐⭐⭐⭐</div>
          </div>
        </div>
        <p class="testimonial-text">"Found the perfect romantic restaurant for our anniversary. The food was amazing and the atmosphere was exactly what we wanted!"</p>
        <span class="restaurant-mention">- Bella Vista</span>
      </div>
      
      <div class="testimonial-card">
        <div class="testimonial-header">
          <img src="/static/images/restaurant-default.jpg" alt="Mike" class="user-avatar">
          <div class="user-info">
            <h4>Mike R.</h4>
            <div class="stars">⭐⭐⭐⭐⭐</div>
          </div>
        </div>
        <p class="testimonial-text">"The sushi recommendations were spot on! Fresh, authentic, and reasonably priced. Will definitely use this app again."</p>
        <span class="restaurant-mention">- Sakura Sushi</span>
      </div>
      
      <div class="testimonial-card">
        <div class="testimonial-header">
          <img src="/static/images/restaurant-default.jpg" alt="Emma" class="user-avatar">
          <div class="user-info">
            <h4>Emma L.</h4>
            <div class="stars">⭐⭐⭐⭐⭐</div>
          </div>
        </div>
        <p class="testimonial-text">"Great for finding family-friendly restaurants. The kids loved the food and we loved the service!"</p>
        <span class="restaurant-mention">- Family Bistro</span>
      </div>
    </div>
  </div>
</section>

<!-- Floating Chatbot Widget -->
<div id="chatbot-toggle" onclick="toggleChatbot()">💬</div>
<div id="chatbot-window">
  <div class="chatbot-header">
    <h4>🍴 Restaurant Assistant</h4>
    <button onclick="toggleChatbot()" class="close-btn">×</button>
  </div>
  <div id="chat-log" class="chatbot-log"></div>
  <div class="chatbot-input-container">
    <input type="text" id="chat-input" placeholder="Ask me about any food...">
    <button onclick="sendMessage()" class="chatbot-send-btn">Send</button>
    <button onclick="testChatbot()" class="chatbot-test-btn" style="margin-left: 5px; padding: 8px 12px; background: #28a745; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 12px;">Test</button>
  </div>
</div>

<style>
.hero { height: auto; min-height: 100vh; }
html, body { overflow: auto; }

/* Welcome Text Styling */
.homepage-title {
  color: #D35400; /* Rich warm orange for appetite and elegance */
}

.homepage-tagline {
  color: #6B4F4F; /* Rich mocha tone for warmth and sophistication */
}

.search-section { display: flex; flex-direction: column; align-items: center; }
.search-wrapper {
  display: flex;
  align-items: center;
  background: #fff;
  border-radius: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  padding: 12px 24px; /* Slightly larger padding for better balance */
  max-width: 700px; /* Slightly wider for balance */
  margin: 20px auto;
}

#search-input {
  flex: 1;
  border: none;
  font-size: 18px;
  padding: 12px;
  border-radius: 30px;
  outline: none;
  color: #333; /* Ensure text is visible */
  background-color: transparent;
}

.search-icon {
  font-size: 22px;
  color: #FF4F00;
  cursor: pointer;
  margin-left: 10px;
}
.suggestion-box { max-width: 500px; width: 100%; margin: 8px auto 0; background:#fff; border:1px solid #f0d0c8; color:#374151; border-radius: 12px; padding: 8px 12px; box-shadow: 0 6px 16px rgba(0,0,0,0.08); display:none; font-size: 14px; }
.reco-box { max-width: 500px; width: 100%; margin: 8px auto 0; }

/* Floating Chatbot Widget Styling */
#chatbot-toggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #FF4F00;
  color: white;
  padding: 12px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 1000;
  transition: transform 0.3s ease, background-color 0.3s ease;
}

#chatbot-toggle:hover {
  transform: scale(1.1);
  background-color: #D35400;
}

#chatbot-window {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 300px;
  height: 400px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  display: none;
  flex-direction: column;
  padding: 0;
  z-index: 1000;
  border: 1px solid #e9ecef;
}

.chatbot-header {
  background: linear-gradient(135deg, #FF4F00, #D35400);
  color: white;
  padding: 15px;
  border-radius: 10px 10px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chatbot-header h4 {
  margin: 0;
  font-size: 16px;
  font-weight: bold;
}

.close-btn {
  background: none;
  border: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background-color 0.3s ease;
}

.close-btn:hover {
  background-color: rgba(255, 255, 255, 0.2);
}

.chatbot-log {
  flex: 1;
  overflow-y: auto;
  padding: 15px;
  background: #f8f9fa;
  max-height: 280px;
}

.chatbot-message {
  margin-bottom: 10px;
  padding: 8px 12px;
  border-radius: 12px;
  max-width: 85%;
  word-wrap: break-word;
  font-size: 14px;
}

.chatbot-message.user {
  background: #FF4F00;
  color: white;
  margin-left: auto;
  text-align: right;
}

.chatbot-message.bot {
  background: #e9ecef;
  color: #333;
  margin-right: auto;
}

.chatbot-input-container {
  padding: 15px;
  background: white;
  border-radius: 0 0 10px 10px;
  display: flex;
  gap: 8px;
}

#chat-input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 20px;
  font-size: 14px;
  outline: none;
  transition: border-color 0.3s ease;
}

#chat-input:focus {
  border-color: #FF4F00;
}

.chatbot-send-btn {
  padding: 8px 16px;
  background-color: #FF4F00;
  color: white;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  transition: background-color 0.3s ease;
  white-space: nowrap;
}

.chatbot-send-btn:hover {
  background-color: #D35400;
}

/* ML-Powered Category Bar Styling */
.category-bar {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 20px;
  flex-wrap: wrap;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
  padding: 0 20px;
}

.category-pill {
  background-color: #FF4F00;
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  border: none;
  text-decoration: none;
  display: inline-block;
}

.category-pill:hover {
  background-color: #D35400;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.category-pill:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}


/* Category Results Styling */
.category-results {
  margin-top: 30px;
  padding: 20px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
  display: none;
}

.category-results.show {
  display: block;
}

.category-results h3 {
  color: #FF4F00;
  margin-bottom: 16px;
  font-size: 20px;
  text-align: center;
}

.category-item-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 12px;
}

.category-item-card {
  background: #f8f9fa;
  padding: 12px 16px;
  border-radius: 8px;
  border-left: 3px solid #FF4F00;
  transition: all 0.3s ease;
  cursor: pointer;
}

.category-item-card:hover {
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transform: translateY(-1px);
}

.category-item-name {
  font-weight: bold;
  color: #333;
  margin-bottom: 4px;
  font-size: 14px;
}

.category-item-description {
  color: #666;
  font-size: 12px;
  line-height: 1.4;
}

.category-item-cuisine {
  color: #FF4F00;
  font-size: 11px;
  font-weight: 500;
  margin-top: 4px;
}

/* ===== NEW PREMIUM SECTIONS STYLING ===== */

/* Container for all sections */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* Section titles and subtitles */
.section-title {
  font-size: 2.5rem;
  font-weight: bold;
  text-align: center;
  margin-bottom: 10px;
  color: #D35400;
  text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.section-subtitle {
  text-align: center;
  color: #6B4F4F;
  font-size: 1.1rem;
  margin-bottom: 40px;
  font-weight: 300;
}

/* ===== FEATURED RESTAURANTS CAROUSEL ===== */
.featured-section {
  background: linear-gradient(135deg, #fff8f0 0%, #fef5e7 100%);
  padding: 80px 0;
  margin: 40px 0;
}

.restaurant-carousel {
  display: flex;
  gap: 30px;
  overflow-x: auto;
  padding: 20px 0;
  scroll-behavior: smooth;
}

.restaurant-carousel::-webkit-scrollbar {
  height: 8px;
}

.restaurant-carousel::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.restaurant-carousel::-webkit-scrollbar-thumb {
  background: #FF4F00;
  border-radius: 10px;
}

.restaurant-card {
  background: white;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  overflow: hidden;
  transition: all 0.3s ease;
  min-width: 350px;
  flex-shrink: 0;
}

.restaurant-card:hover {
  transform: translateY(-10px);
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

.restaurant-image {
  position: relative;
  height: 200px;
  overflow: hidden;
}

.restaurant-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.restaurant-card:hover .restaurant-image img {
  transform: scale(1.05);
}

.rating-badge {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(255, 255, 255, 0.95);
  padding: 8px 12px;
  border-radius: 20px;
  font-weight: bold;
  color: #FF4F00;
  font-size: 14px;
  backdrop-filter: blur(10px);
}

.restaurant-info {
  padding: 25px;
}

.restaurant-info h3 {
  font-size: 1.4rem;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 8px;
}

.cuisine-tag {
  color: #FF4F00;
  font-weight: 600;
  font-size: 0.9rem;
  margin-bottom: 10px;
}

.restaurant-description {
  color: #666;
  font-size: 0.95rem;
  line-height: 1.5;
  margin-bottom: 15px;
}

.restaurant-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.price-range {
  font-weight: bold;
  color: #27ae60;
  font-size: 1.1rem;
}

.distance {
  color: #7f8c8d;
  font-size: 0.9rem;
}

.view-details-btn {
  width: 100%;
  background: linear-gradient(135deg, #FF4F00, #D35400);
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 25px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1rem;
}

.view-details-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 79, 0, 0.3);
}

/* ===== NEAR YOU SECTION ===== */
.near-you-section {
  background: #f8f9fa;
  padding: 80px 0;
  margin: 40px 0;
}

.location-input-container {
  display: flex;
  max-width: 500px;
  margin: 0 auto 40px;
  background: white;
  border-radius: 30px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  overflow: hidden;
}

#location-input {
  flex: 1;
  padding: 15px 20px;
  border: none;
  font-size: 1rem;
  outline: none;
}

.location-btn {
  background: #FF4F00;
  color: white;
  border: none;
  padding: 15px 20px;
  cursor: pointer;
  font-size: 1.2rem;
  transition: background 0.3s ease;
}

.location-btn:hover {
  background: #D35400;
}

.nearby-restaurants {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.nearby-card {
  background: white;
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  display: flex;
  gap: 15px;
  transition: transform 0.3s ease;
}

.nearby-card:hover {
  transform: translateY(-5px);
}

.nearby-card img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 10px;
}

.nearby-info {
  flex: 1;
}

.nearby-info h4 {
  font-size: 1.2rem;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 5px;
}

.nearby-info p {
  color: #666;
  font-size: 0.9rem;
  margin-bottom: 10px;
}

.quick-actions {
  display: flex;
  gap: 10px;
}

.quick-btn {
  background: #FF4F00;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 15px;
  font-size: 0.8rem;
  cursor: pointer;
  transition: background 0.3s ease;
}

.quick-btn:hover {
  background: #D35400;
}

.explore-nearby-btn {
  display: block;
  margin: 0 auto;
  background: linear-gradient(135deg, #FF4F00, #D35400);
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 30px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1.1rem;
}

.explore-nearby-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 79, 0, 0.3);
}

/* ===== TRENDING SEARCHES ===== */
.trending-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 80px 0;
  margin: 40px 0;
  color: white;
}

.trending-section .section-title,
.trending-section .section-subtitle {
  color: white;
}

.trending-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: center;
}

.trending-tag {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  border-radius: 25px;
  padding: 15px 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 120px;
  animation: float 3s ease-in-out infinite;
}

.trending-tag:nth-child(odd) {
  animation-delay: 0.5s;
}

.trending-tag:nth-child(even) {
  animation-delay: 1s;
}

.trending-tag:hover {
  transform: translateY(-5px);
  background: rgba(255, 255, 255, 0.3);
}

.trending-text {
  font-weight: bold;
  font-size: 1.1rem;
  margin-bottom: 5px;
}

.trending-count {
  font-size: 0.8rem;
  opacity: 0.8;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

/* ===== AI RECOMMENDATION ENGINE ===== */
.ai-recommendation-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 80px 0;
  margin: 40px 0;
  color: white;
}

.ai-recommendation-section .section-title,
.ai-recommendation-section .section-subtitle {
  color: white;
}

.recommendation-form {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 20px;
  padding: 40px;
  max-width: 800px;
  margin: 0 auto;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  backdrop-filter: blur(10px);
}

.form-group {
  margin-bottom: 25px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #2c3e50;
  font-size: 1rem;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 15px 20px;
  border: 2px solid #e9ecef;
  border-radius: 12px;
  font-size: 1rem;
  transition: all 0.3s ease;
  background: white;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}

.recommend-btn {
  width: 100%;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  padding: 18px 30px;
  border-radius: 15px;
  font-size: 1.2rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.recommend-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
}

.recommend-btn:active {
  transform: translateY(0);
}

.recommend-btn.loading {
  pointer-events: none;
}

.recommend-btn.loading .btn-text {
  display: none;
}

.recommend-btn.loading .btn-loading {
  display: inline;
}

.recommendations-results {
  margin-top: 40px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 20px;
  padding: 30px;
  backdrop-filter: blur(10px);
}

.recommendations-results h3 {
  color: #2c3e50;
  text-align: center;
  margin-bottom: 25px;
  font-size: 1.5rem;
}

.recommendations-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.recommendation-card {
  background: white;
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  border-left: 4px solid #667eea;
}

.recommendation-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.recommendation-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 15px;
}

.recommendation-name {
  font-size: 1.2rem;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 5px;
}

.recommendation-score {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: bold;
}

.recommendation-cuisine {
  color: #667eea;
  font-weight: 600;
  margin-bottom: 8px;
}

.recommendation-location {
  color: #666;
  font-size: 0.9rem;
  margin-bottom: 10px;
}

.recommendation-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.recommendation-rating {
  color: #f39c12;
  font-weight: bold;
}

.recommendation-cost {
  color: #27ae60;
  font-weight: bold;
}

.recommendation-actions {
  display: flex;
  gap: 10px;
}

.recommendation-btn {
  flex: 1;
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.recommendation-btn.primary {
  background: #667eea;
  color: white;
}

.recommendation-btn.primary:hover {
  background: #5a6fd8;
}

.recommendation-btn.secondary {
  background: #f8f9fa;
  color: #667eea;
  border: 1px solid #667eea;
}

.recommendation-btn.secondary:hover {
  background: #667eea;
  color: white;
}

/* ===== MOOD-BASED FILTERS ===== */
.mood-section {
  background: #f8f9fa;
  padding: 80px 0;
  margin: 40px 0;
}

.mood-filters {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  max-width: 1000px;
  margin: 0 auto;
}

.mood-card {
  background: white;
  border-radius: 20px;
  padding: 30px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  border: 3px solid transparent;
}

.mood-card:hover {
  transform: translateY(-10px);
  box-shadow: 0 15px 30px rgba(0,0,0,0.15);
  border-color: #FF4F00;
}

.mood-icon {
  font-size: 3rem;
  margin-bottom: 15px;
  display: block;
}

.mood-card h4 {
  font-size: 1.3rem;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 10px;
}

.mood-card p {
  color: #666;
  font-size: 0.9rem;
  line-height: 1.4;
}

/* ===== FOOD GALLERY ===== */
.food-gallery-section {
  background: #2c3e50;
  padding: 80px 0;
  margin: 40px 0;
}

.food-gallery-section .section-title,
.food-gallery-section .section-subtitle {
  color: white;
}

.food-gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  max-width: 1000px;
  margin: 0 auto;
}

.gallery-item {
  position: relative;
  border-radius: 15px;
  overflow: hidden;
  aspect-ratio: 1;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.gallery-item:hover {
  transform: scale(1.05);
}

.gallery-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.gallery-item:hover img {
  transform: scale(1.1);
}

.gallery-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(0,0,0,0.7), rgba(0,0,0,0.3));
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 20px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.gallery-item:hover .gallery-overlay {
  opacity: 1;
}

.wishlist-btn {
  background: rgba(255, 79, 0, 0.9);
  color: white;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
  align-self: flex-end;
}

.wishlist-btn:hover {
  background: #FF4F00;
  transform: scale(1.1);
}

.restaurant-name {
  color: white;
  font-weight: bold;
  font-size: 1.1rem;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

/* ===== REVIEWS & TESTIMONIALS ===== */
.reviews-section {
  background: linear-gradient(135deg, #fef5e7 0%, #fff8f0 100%);
  padding: 80px 0;
  margin: 40px 0;
}

.testimonials {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 30px;
  max-width: 1200px;
  margin: 0 auto;
}

.testimonial-card {
  background: white;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  transition: transform 0.3s ease;
  position: relative;
}

.testimonial-card:hover {
  transform: translateY(-5px);
}

.testimonial-card::before {
  content: '"';
  position: absolute;
  top: -10px;
  left: 20px;
  font-size: 4rem;
  color: #FF4F00;
  opacity: 0.3;
  font-family: serif;
}

.testimonial-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
}

.user-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
}

.user-info h4 {
  font-size: 1.1rem;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 5px;
}

.stars {
  font-size: 1.2rem;
}

.testimonial-text {
  color: #555;
  font-size: 1rem;
  line-height: 1.6;
  margin-bottom: 15px;
  font-style: italic;
}

.restaurant-mention {
  color: #FF4F00;
  font-weight: bold;
  font-size: 0.9rem;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
  .section-title {
    font-size: 2rem;
  }
  
  .restaurant-carousel {
    flex-direction: column;
    align-items: center;
  }
  
  .restaurant-card {
    min-width: 300px;
    max-width: 350px;
  }
  
  .trending-tags {
    flex-direction: column;
    align-items: center;
  }
  
  .mood-filters {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
  
  .food-gallery {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }
  
  .testimonials {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
function goToCategory(name) {
  window.location.href = `/restaurants?cuisine=${encodeURIComponent(name)}`;
}

function mapCategoryToImage(cat){
  const c = String(cat || '').toLowerCase();
  if (c.includes('pizza')) return '/static/images/pizza.jpg';
  if (c.includes('burger')) return '/static/images/burger.jpg';
  if (c.includes('sushi') || c.includes('japan')) return '/static/images/sushi.jpg';
  if (c.includes('pasta') || c.includes('italian')) return '/static/images/pasta.jpg';
  if (c.includes('bbq') || c.includes('grill') || c.includes('steak')) return '/static/images/bbq.jpg';
  if (c.includes('cake') || c.includes('dessert')) return '/static/images/cake.jpg';
  if (c.includes('noodle') || c.includes('chinese') || c.includes('thai')) return '/static/images/noodles.jpg';
  if (c.includes('taco') || c.includes('mex')) return '/static/images/tacos.jpg';
  if (c.includes('coffee') || c.includes('cafe')) return '/static/images/coffee.jpg';
  if (c.includes('seafood')) return '/static/images/seafood.jpg';
  if (c.includes('vegan') || c.includes('salad')) return '/static/images/vegan.jpg';
  if (c.includes('breakfast') || c.includes('brunch')) return '/static/images/breakfast.jpg';
  return '/static/images/restaurant-default.jpg';
}

document.addEventListener('DOMContentLoaded', function(){
  const homeInput = document.getElementById('search-input');
  const homeSuggest = document.getElementById('suggestion-box');
  let homeTimer = null;

  // Check model status on page load
  fetch('/predict/status')
    .then(r => r.json())
    .then(status => {
      console.log('ML Model Status:', status);
      if (!status.vectorizer_ready || !status.model_ready) {
        console.log('ML model not ready yet, using fallback suggestions');
      }
    })
    .catch(err => console.log('Could not check model status:', err));

  // Predictive typing for homepage search
  if (homeInput && homeSuggest) {
    homeInput.addEventListener('input', async (e) => {
      const text = e.target.value;
      if (text.length >= 2) {
        try {
          console.log('Sending prediction request for:', text);
          const res = await fetch('/predict', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text })
          });
          const data = await res.json();
          console.log('Prediction response:', data);
          const suggestion = (data && (data.suggestion || data.next_token)) ? String(data.suggestion || data.next_token) : '';
          if (suggestion && suggestion !== text) {
            homeSuggest.innerHTML = `Did you mean: <span style="color: #FF4F00; cursor: pointer; text-decoration: underline;" onclick="useSuggestion('${suggestion}')">${suggestion}</span>`;
            homeSuggest.style.display = 'block';
          } else {
            // Fallback: show common suggestions based on input
            const fallbackSuggestions = {
              'piz': 'pizza', 'bur': 'burger', 'sus': 'sushi', 'pas': 'pasta', 'cof': 'coffee',
              'chi': 'chinese', 'ita': 'italian', 'jap': 'japanese', 'mex': 'mexican', 'ind': 'indian'
            };
            const fallback = fallbackSuggestions[text.toLowerCase()];
            if (fallback) {
              homeSuggest.innerHTML = `Did you mean: <span style="color: #FF4F00; cursor: pointer; text-decoration: underline;" onclick="useSuggestion('${fallback}')">${fallback}</span>`;
              homeSuggest.style.display = 'block';
            } else {
              homeSuggest.style.display = 'none';
            }
          }
        } catch (err) {
          console.error('Prediction error:', err);
          homeSuggest.style.display = 'none';
        }
      } else {
        homeSuggest.style.display = 'none';
      }
    });
  }
  // Category sections removed - no longer loading categories
});
</script>

<script>
function submitSearch() {
  const query = document.getElementById('search-input').value;
  window.location.href = `/restaurants?search=${encodeURIComponent(query)}`;
}

function useSuggestion(suggestion) {
  const input = document.getElementById('search-input');
  if (input) {
    input.value = suggestion;
    submitSearch();
  }
}

// Floating Chatbot Widget Functionality
function toggleChatbot() {
  const chatWindow = document.getElementById('chatbot-window');
  const isVisible = chatWindow.style.display === 'flex';
  chatWindow.style.display = isVisible ? 'none' : 'flex';
  
  // Focus on input when opening
  if (!isVisible) {
    setTimeout(() => {
      const input = document.getElementById('chat-input');
      if (input) input.focus();
    }, 100);
  }
}

async function sendMessage() {
  const input = document.getElementById('chat-input');
  const message = input.value.trim();
  
  if (!message) return;
  
  console.log('Sending message to chatbot:', message);
  
  // Add user message to chat log
  addMessageToChat(message, 'user');
  input.value = '';
  
  // Show typing indicator
  const typingId = addMessageToChat('Thinking...', 'bot');
  
  try {
    console.log('Making fetch request to /chatbot...');
    const response = await fetch('/chatbot', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: message })
    });
    
    console.log('Chatbot response status:', response.status);
    console.log('Chatbot response headers:', response.headers);
    
    if (!response.ok) {
      const errorText = await response.text();
      console.error('Response not OK:', response.status, errorText);
      throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
    }
    
    const data = await response.json();
    console.log('Chatbot response data:', data);
    
    if (!data || !data.response) {
      console.error('Invalid response format:', data);
      throw new Error('Invalid response format from server');
    }
    
    // Remove typing indicator and add bot response
    removeMessageFromChat(typingId);
    addMessageToChat(data.response, 'bot');
    
  } catch (error) {
    console.error('Chatbot error:', error);
    removeMessageFromChat(typingId);
    addMessageToChat(`Sorry, I encountered an error: ${error.message}. Please try again!`, 'bot');
  }
}

function addMessageToChat(message, sender) {
  const chatLog = document.getElementById('chat-log');
  const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
  
  const messageDiv = document.createElement('div');
  messageDiv.id = messageId;
  messageDiv.className = `chatbot-message ${sender}`;
  messageDiv.innerHTML = formatMessage(message);
  
  chatLog.appendChild(messageDiv);
  chatLog.scrollTop = chatLog.scrollHeight;
  
  return messageId;
}

function removeMessageFromChat(messageId) {
  const message = document.getElementById(messageId);
  if (message) {
    message.remove();
  }
}

function formatMessage(message) {
  // Convert markdown-style formatting to HTML
  return message
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\n/g, '<br>');
}

// Allow Enter key to send message
document.addEventListener('DOMContentLoaded', function() {
  const chatInput = document.getElementById('chat-input');
  if (chatInput) {
    chatInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });
  }
  
  // Check chatbot status on page load
  checkChatbotStatus();
  
  // Load ML-extracted categories
  loadCategories();
});

async function checkChatbotStatus() {
  try {
    const response = await fetch('/chatbot/status');
    const status = await response.json();
    console.log('Chatbot status:', status);
    
    if (status.vectorizer_ready && status.vectors_ready) {
      console.log(`Chatbot is ready with ${status.restaurant_count} restaurants`);
    } else {
      console.log('Chatbot is still initializing...');
    }
  } catch (error) {
    console.log('Could not check chatbot status:', error);
  }
}

async function testChatbot() {
  console.log('Testing chatbot...');
  try {
    const response = await fetch('/chatbot/test');
    const data = await response.json();
    console.log('Test response:', data);
    
    if (data.error) {
      addMessageToChat(`Test failed: ${data.error}`, 'bot');
    } else {
      addMessageToChat(`Test successful! Found ${data.restaurant_count} restaurants. Response: ${data.response.substring(0, 100)}...`, 'bot');
    }
  } catch (error) {
    console.error('Test error:', error);
    addMessageToChat(`Test error: ${error.message}`, 'bot');
  }
}

async function loadCategories() {
  try {
    console.log('Loading ML-extracted categories...');
    const response = await fetch('/categories');
    const data = await response.json();
    
    console.log('Categories loaded:', data.categories);
    
    const categoryBar = document.getElementById('category-bar');
    if (categoryBar && data.categories) {
      categoryBar.innerHTML = '';
      
      data.categories.forEach(category => {
        const pill = document.createElement('div');
        pill.className = 'category-pill';
        pill.textContent = category;
        pill.onclick = () => goToCategory(category);
        categoryBar.appendChild(pill);
      });
    }
  } catch (error) {
    console.error('Error loading categories:', error);
    
    // Fallback categories if API fails
    const categoryBar = document.getElementById('category-bar');
    if (categoryBar) {
      const fallbackCategories = ['Pizza', 'Chinese', 'Italian', 'Japanese', 'Indian', 'Mexican', 'Thai', 'American'];
      categoryBar.innerHTML = '';
      
      fallbackCategories.forEach(category => {
        const pill = document.createElement('div');
        pill.className = 'category-pill';
        pill.textContent = category;
        pill.onclick = () => goToCategory(category);
        categoryBar.appendChild(pill);
      });
    }
  }
}

async function loadCategory(category) {
  try {
    console.log(`Loading items for category: ${category}`);
    
    const response = await fetch('/category-items', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ category: category })
    });
    
    const data = await response.json();
    console.log(`Found ${data.items.length} items for category '${category}'`);
    
    const container = document.getElementById('category-results');
    if (container) {
      if (data.items && data.items.length > 0) {
        container.innerHTML = `
          <h3>${category} Items</h3>
          <div class="category-item-list">
            ${data.items.map(item => `
              <div class="category-item-card" onclick="goToCategory('${item.name}')">
                <div class="category-item-name">${item.name}</div>
                <div class="category-item-description">${item.description}</div>
                ${item.cuisine ? `<div class="category-item-cuisine">${item.cuisine}</div>` : ''}
              </div>
            `).join('')}
          </div>
        `;
        container.classList.add('show');
      } else {
        container.innerHTML = `
          <h3>${category} Items</h3>
          <p style="text-align: center; color: #666; padding: 20px;">
            No items found for this category. Try another category!
          </p>
        `;
        container.classList.add('show');
      }
    }
  } catch (error) {
    console.error('Error loading category items:', error);
    
    const container = document.getElementById('category-results');
    if (container) {
      container.innerHTML = `
        <h3>${category} Items</h3>
        <p style="text-align: center; color: #666; padding: 20px;">
          Error loading items. Please try again later.
        </p>
      `;
      container.classList.add('show');
    }
  }
}

    // Smart Filters Functions - Using main.js implementation
      const mood = document.getElementById('mood-filter').value;
      const time = document.getElementById('time-filter').value;
      const occasion = document.getElementById('occasion-filter').value;
      
      console.log('Applying filters:', { mood, time, occasion });
      
      // Add visual feedback
      const primaryBtn = document.querySelector('.filter-primary-btn');
      const originalText = primaryBtn.querySelector('.btn-text').textContent;
      const originalIcon = primaryBtn.querySelector('.btn-icon').textContent;
      
      primaryBtn.querySelector('.btn-text').textContent = 'Finding...';
      primaryBtn.querySelector('.btn-icon').textContent = '⏳';
      primaryBtn.style.pointerEvents = 'none';
      
      // Prepare request data
      const requestData = {
        mood: mood,
        time: time,
        occasion: occasion
      };
      
      console.log('Sending request to /api/smart-filters:', requestData);
      
      // Make API call to smart filters endpoint
      fetch('/api/smart-filters', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestData)
      })
      .then(response => {
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('Received data:', data);
        console.log('Data type:', typeof data);
        console.log('Data keys:', Object.keys(data || {}));
        
        if (data && data.error) {
          console.error('API Error:', data.error);
          showFilterResults([]);
        } else if (data && data.recommendations && Array.isArray(data.recommendations) && data.recommendations.length > 0) {
          console.log('Success! Found', data.recommendations.length, 'recommendations');
          console.log('First recommendation:', data.recommendations[0]);
          showFilterResults(data.recommendations);
        } else {
          console.log('No recommendations found or invalid data structure');
          console.log('Recommendations:', data ? data.recommendations : 'data is null');
          showFilterResults([]);
        }
      })
      .catch(error => {
        console.error('Error fetching recommendations:', error);
        console.log('Trying fallback endpoint...');
        
        // Try fallback to the main recommend endpoint
        return fetch('/recommend', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            user_input: 'restaurant',
            mood: mood,
            time: time,
            occasion: occasion
          })
        });
      })
      .then(response => {
        if (response && response.ok) {
          return response.json();
        }
        throw new Error('Fallback also failed');
      })
      .then(data => {
        console.log('Fallback data:', data);
        if (data && data.recommendations && data.recommendations.length > 0) {
          showFilterResults(data.recommendations);
        } else {
          showFilterResults([]);
        }
      })
      .catch(error => {
        console.error('All endpoints failed:', error);
        showFilterResults([]);
      })
      .finally(() => {
        // Reset button state
        primaryBtn.querySelector('.btn-text').textContent = originalText;
        primaryBtn.querySelector('.btn-icon').textContent = originalIcon;
        primaryBtn.style.pointerEvents = 'auto';
      });
    }

    function clearAllFilters() {
      // Clear all select values
      document.getElementById('mood-filter').value = '';
      document.getElementById('time-filter').value = '';
      document.getElementById('occasion-filter').value = '';
      
      // Add visual feedback
      const secondaryBtn = document.querySelector('.filter-secondary-btn');
      const originalText = secondaryBtn.querySelector('.btn-text').textContent;
      const originalIcon = secondaryBtn.querySelector('.btn-icon').textContent;
      
      secondaryBtn.querySelector('.btn-text').textContent = 'Cleared!';
      secondaryBtn.querySelector('.btn-icon').textContent = '✅';
      
      // Clear results
      clearFilterResults();
      
      setTimeout(() => {
        secondaryBtn.querySelector('.btn-text').textContent = originalText;
        secondaryBtn.querySelector('.btn-icon').textContent = originalIcon;
      }, 1500);
    }

    function showFilterResults(recommendations) {
      console.log('Showing results for:', recommendations);
      console.log('Recommendations type:', typeof recommendations);
      console.log('Recommendations length:', recommendations ? recommendations.length : 'null/undefined');
      
      // Use the existing smart-filter-results container
      let resultsContainer = document.getElementById('smart-filter-results');
      if (!resultsContainer) {
        console.error('smart-filter-results container not found!');
        return;
      }
      
      // Show the container
      resultsContainer.style.display = 'block';
      
      if (!recommendations || recommendations.length === 0) {
        console.log('No recommendations found, showing no results message');
        resultsContainer.innerHTML = `
          <div class="no-results">
            <div class="no-results-icon">🔍</div>
            <h3>No restaurants found</h3>
            <p>Try adjusting your filters or search for something different</p>
            <button class="btn btn-primary" onclick="clearAllFilters()">Clear Filters</button>
          </div>
        `;
        return;
      }
      
      console.log('Processing', recommendations.length, 'recommendations');
      
      // Create results HTML
      let resultsHTML = `
        <div class="results-header">
          <h3>🍽️ Perfect Matches Found</h3>
          <p>${recommendations.length} restaurants match your preferences</p>
        </div>
        <div class="results-grid">
      `;
      
      recommendations.forEach((restaurant, index) => {
        const rating = restaurant.rating || 0;
        const cost = restaurant.cost || 0;
        const matchScore = restaurant.match_score || 0;
        
        resultsHTML += `
          <div class="restaurant-card" data-index="${index}">
            <div class="card-header">
              <h4 class="restaurant-name">${restaurant.name}</h4>
              <div class="match-badge">${Math.round(matchScore * 100)}% match</div>
            </div>
            <div class="card-body">
              <div class="restaurant-info">
                <div class="cuisine-tags">
                  ${restaurant.cuisines ? restaurant.cuisines.split(',').map(c => `<span class="cuisine-tag">${c.trim()}</span>`).join('') : ''}
                </div>
                <div class="restaurant-details">
                  <div class="detail-item">
                    <span class="detail-icon">⭐</span>
                    <span class="detail-text">${rating.toFixed(1)}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-icon">💰</span>
                    <span class="detail-text">₹${cost}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-icon">📍</span>
                    <span class="detail-text">${restaurant.address || restaurant.location}</span>
                  </div>
                </div>
                ${restaurant.dish_liked ? `
                  <div class="dish-liked">
                    <strong>Popular:</strong> ${restaurant.dish_liked}
                  </div>
                ` : ''}
              </div>
            </div>
            <div class="card-footer">
              <div class="restaurant-actions">
                ${restaurant.online_order ? '<span class="action-badge online-order">📱 Online Order</span>' : ''}
                ${restaurant.book_table ? '<span class="action-badge book-table">🍽️ Book Table</span>' : ''}
              </div>
              <button class="btn btn-outline" onclick="viewRestaurantDetails('${restaurant.name}')">
                View Details
              </button>
            </div>
          </div>
        `;
      });
      
      resultsHTML += `
        </div>
        <div class="results-footer">
          <button class="btn btn-secondary" onclick="clearAllFilters()">Try Different Filters</button>
        </div>
      `;
      
      resultsContainer.innerHTML = resultsHTML;
      
      // Scroll to results
      resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function clearFilterResults() {
      const resultsContainer = document.getElementById('smart-filter-results');
      if (resultsContainer) {
        resultsContainer.style.display = 'none';
        resultsContainer.innerHTML = '';
      }
    }

    function viewRestaurantDetails(restaurantName) {
      // Navigate to restaurant details page
      window.location.href = `/restaurant/${encodeURIComponent(restaurantName)}`;
    }

function displayRecommendations(recommendations, query) {
  const resultsDiv = document.getElementById('recommendations-results');
  const listDiv = document.getElementById('recommendations-list');
  
  if (!recommendations || recommendations.length === 0) {
    listDiv.innerHTML = `
      <div style="text-align: center; padding: 40px; color: #666;">
        <h4>No recommendations found</h4>
        <p>Try adjusting your preferences or search terms.</p>
      </div>
    `;
    resultsDiv.style.display = 'block';
    return;
  }
  
  listDiv.innerHTML = recommendations.map(rec => `
    <div class="recommendation-card">
      <div class="recommendation-header">
        <div>
          <div class="recommendation-name">${rec.name}</div>
          <div class="recommendation-cuisine">${rec.cuisines}</div>
          <div class="recommendation-location">📍 ${rec.address}</div>
        </div>
        <div class="recommendation-score">${Math.round(rec.match_score * 100)}% match</div>
      </div>
      
      <div class="recommendation-meta">
        <div class="recommendation-rating">⭐ ${rec.rating}/5</div>
        <div class="recommendation-cost">💰 ₹${rec.cost} for two</div>
      </div>
      
      <div class="recommendation-actions">
        <button class="recommendation-btn primary" onclick="viewRestaurantDetails('${rec.name}')">
          View Details
        </button>
        <button class="recommendation-btn secondary" onclick="addToWishlist('${rec.name}')">
          ❤️ Save
        </button>
      </div>
    </div>
  `).join('');
  
  resultsDiv.style.display = 'block';
  
  // Scroll to results
  resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function viewRestaurantDetails(restaurantName) {
  console.log(`Viewing details for: ${restaurantName}`);
  window.location.href = `/restaurants?search=${encodeURIComponent(restaurantName)}`;
}

// Featured Restaurants Functions
function goToRestaurant(restaurantName) {
  console.log(`Navigating to restaurant: ${restaurantName}`);
  window.location.href = `/restaurants?search=${encodeURIComponent(restaurantName)}`;
}

// Location-based Functions
function getCurrentLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function(position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        console.log(`Current location: ${lat}, ${lng}`);
        
        // Update location input
        const locationInput = document.getElementById('location-input');
        if (locationInput) {
          locationInput.value = `Current Location (${lat.toFixed(4)}, ${lng.toFixed(4)})`;
        }
        
        // Load nearby restaurants
        loadNearbyRestaurants(lat, lng);
      },
      function(error) {
        console.error('Error getting location:', error);
        alert('Unable to get your location. Please enter it manually.');
      }
    );
  } else {
    alert('Geolocation is not supported by this browser.');
  }
}

function loadNearbyRestaurants(lat, lng) {
  console.log(`Loading restaurants near ${lat}, ${lng}`);
  // This would typically make an API call to get nearby restaurants
  // For now, we'll just show a message
  alert(`Finding restaurants near your location (${lat.toFixed(4)}, ${lng.toFixed(4)})...`);
}

function exploreNearby() {
  const locationInput = document.getElementById('location-input');
  const location = locationInput ? locationInput.value : '';
  
  if (location.trim()) {
    console.log(`Exploring nearby restaurants for: ${location}`);
    window.location.href = `/restaurants?location=${encodeURIComponent(location)}`;
  } else {
    alert('Please enter a location first.');
  }
}

// Trending Searches Functions
function searchTrending(trend) {
  console.log(`Searching for trending item: ${trend}`);
  window.location.href = `/restaurants?search=${encodeURIComponent(trend)}`;
}

// Add click handlers to trending tags
document.addEventListener('DOMContentLoaded', function() {
  const trendingTags = document.querySelectorAll('.trending-tag');
  trendingTags.forEach(tag => {
    tag.addEventListener('click', function() {
      const trendText = this.querySelector('.trending-text').textContent;
      searchTrending(trendText);
    });
  });
});

// Mood-based Filter Functions
function filterByMood(mood) {
  console.log(`Filtering by mood: ${mood}`);
  
  // Add visual feedback
  const moodCards = document.querySelectorAll('.mood-card');
  moodCards.forEach(card => {
    card.style.borderColor = 'transparent';
  });
  
  event.currentTarget.style.borderColor = '#FF4F00';
  
  // Navigate to restaurants with mood filter
  window.location.href = `/restaurants?mood=${encodeURIComponent(mood)}`;
}

// Food Gallery Functions
function addToWishlist(item) {
  console.log(`Adding to wishlist: ${item}`);
  
  // Add visual feedback
  const button = event.currentTarget;
  const originalText = button.textContent;
  button.textContent = '❤️';
  button.style.background = '#e74c3c';
  
  // Show success message
  setTimeout(() => {
    button.textContent = originalText;
    button.style.background = 'rgba(255, 79, 0, 0.9)';
  }, 1000);
  
  // This would typically save to user's wishlist
  alert(`Added ${item} to your wishlist!`);
}

// Smooth scrolling for better UX
function smoothScrollTo(elementId) {
  const element = document.getElementById(elementId);
  if (element) {
    element.scrollIntoView({ 
      behavior: 'smooth',
      block: 'start'
    });
  }
}

// Add scroll animations
function addScrollAnimations() {
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
        entry.target.style.transform = 'translateY(0)';
      }
    });
  }, observerOptions);
  
  // Observe all sections
  const sections = document.querySelectorAll('section');
  sections.forEach(section => {
    section.style.opacity = '0';
    section.style.transform = 'translateY(30px)';
    section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
    observer.observe(section);
  });
}

// Initialize scroll animations when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  addScrollAnimations();
  
  // Fix filter text visibility
  fixFilterTextVisibility();
});

// Function to ensure filter text is always visible
function fixFilterTextVisibility() {
  const selects = document.querySelectorAll('.modern-select');
  
  selects.forEach(select => {
    // Force text color on load
    select.style.color = '#1F2937';
    select.style.backgroundColor = 'white';
    
    // Add event listeners to maintain visibility
    select.addEventListener('focus', function() {
      this.style.color = '#1F2937';
      this.style.backgroundColor = 'white';
    });
    
    select.addEventListener('blur', function() {
      this.style.color = '#1F2937';
      this.style.backgroundColor = 'white';
    });
    
    select.addEventListener('change', function() {
      this.style.color = '#1F2937';
      this.style.backgroundColor = 'white';
    });
    
    // Force visibility on mouse events
    select.addEventListener('mouseenter', function() {
      this.style.color = '#1F2937';
      this.style.backgroundColor = 'white';
    });
    
    select.addEventListener('mouseleave', function() {
      this.style.color = '#1F2937';
      this.style.backgroundColor = 'white';
    });
  });
  
  // Also fix option elements
  const options = document.querySelectorAll('.modern-select option');
  options.forEach(option => {
    option.style.color = '#1F2937';
    option.style.backgroundColor = 'white';
  });
}
</script>

{% endblock %}
